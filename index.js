"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Router=function(){function t(e){_classCallCheck(this,t),this.currentRoute={path:""},this.history=[],this.registerComponents=new Map,this.routeRecord=Object.create(null),this.waitCallComponents=[],this._beforePathChange=null,this._afterPathChange=null,this._init(e)}return _createClass(t,[{key:"_init",value:function(e){var t=this;e.routes.forEach(function(e){t._recordInit(e,t.routeRecord)});var r="/";e.option&&e.option.initPath&&(r=e.option.initPath),this.push(r)}},{key:"_recordInit",value:function(e,t){var r=this,n=e.path.replace(/^\/([^\/]*).*/,"$1");if(t[n]=_objectSpread({},e),e.children&&e.children.length){var o=e.children;t[n].children={},o.forEach(function(e){r._recordInit(e,t[n].children)})}}},{key:"push",value:function(e){var t="string"==typeof e?{path:e}:e,r=_slicedToArray(this._matchRouteRecord(t),2),n=r[0],o=r[1],i=_objectSpread({},n,{},t);this._invokeBeforeHooks(i)&&(this._freshView(o),this.currentRoute=i,this.history.push(i),this._invokeAfterHooks&&this._invokeAfterHooks())}},{key:"replace",value:function(e){var t="string"==typeof e?{path:e}:e,r=_slicedToArray(this._matchRouteRecord(t),2),n=r[0],o=r[1],i=_objectSpread({},n,{},t);this._invokeBeforeHooks(i)&&(this._freshView(o),this.currentRoute=i,this.history.pop(),this.history.push(i),this._invokeAfterHooks&&this._invokeAfterHooks())}},{key:"_matchRouteRecord",value:function(e){var t=e.path.replace(/^\/(.*)$/,"$1").split("/"),n=[];return[t.reduce(function(e,t){var r=e[t];return n.push(r.component||t),r.children||r},this.routeRecord),n]}},{key:"_freshView",value:function(e){this.waitCallComponents=e;var t=!0,r=!1,n=void 0;try{for(var o,i=this.registerComponents.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value,s=a.data.name,h=this.waitCallComponents.shift();if(a.setData({name:h}),s!==h)break}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}},{key:"registerComponent",value:function(e){var t=e.$id;0<this.waitCallComponents.length&&e.setData({name:this.waitCallComponents.shift()}),this.registerComponents.set(t,e)}},{key:"removeComponent",value:function(e){var t=e.$id;this.registerComponents.delete(t)}},{key:"setBeforeChange",value:function(e,t){null!==e?e[t]instanceof Function&&(this._beforePathChange=_this[t].bind(e)):this._beforePathChange=null}},{key:"setAfterChange",value:function(e,t){null!==e?e[t]instanceof Function&&(this._afterPathChange=e[t].bind(e)):this._afterPathChange=null}},{key:"_invokeBeforeHooks",value:function(e){return null===this._beforePathChange||this._beforePathChange(this.currentRoute,e)}},{key:"_invokeAfterHooks",value:function(){return null===this._afterPathChange||this._afterPathChange()}}]),t}();exports.default=Router;